<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0d1117">
    <title>60' Hunter</title>

    <link rel="manifest" href="./manifest.json">
    <link rel="icon" type="image/png" href="target_PNG26.png">
    <link rel="apple-touch-icon" href="target_PNG26.png">

    <style>
        :root { --bg: #0d1117; --card: #161b22; --green: #2ea043; --gold: #d29922; --red: #da3633; --text: #c9d1d9; }
        body { background: var(--bg); color: var(--text); font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 0; padding: 16px; padding-bottom: 120px; }
        
        /* HEADER */
        header { display: flex; flex-direction: column; gap: 10px; border-bottom: 1px solid #30363d; padding-bottom: 15px; margin-bottom: 15px; }
        .top-row { display: flex; justify-content: space-between; align-items: center; width: 100%; }
        h1 { margin: 0; font-size: 1.4rem; color: var(--green); display: flex; align-items: center; gap: 10px; }
        
        /* AUTO-PILOT TOGGLE */
        .pilot-btn {
            background: #21262d; border: 1px solid #30363d; color: #888;
            padding: 6px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: bold;
            display: flex; align-items: center; gap: 6px; cursor: pointer; transition: all 0.3s;
        }
        .pilot-btn.active { background: rgba(46, 160, 67, 0.2); border-color: var(--green); color: var(--green); }
        .pilot-dot { width: 8px; height: 8px; border-radius: 50%; background: #555; }
        .pilot-btn.active .pilot-dot { background: var(--green); box-shadow: 0 0 8px var(--green); }

        select {
            width: 100%; padding: 12px; background: #21262d; color: white;
            border: 1px solid #30363d; border-radius: 8px; font-size: 1rem; font-weight: bold;
            outline: none; appearance: none;
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23FFFFFF%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
            background-repeat: no-repeat; background-position: right 15px top 50%; background-size: 12px auto;
        }

        /* CARDS */
        .match-card { background: var(--card); border: 1px solid #30363d; border-radius: 12px; padding: 15px; margin-bottom: 15px; position: relative; overflow: hidden; }
        .league-name { font-size: 0.75rem; color: #8b949e; text-transform: uppercase; margin-bottom: 8px; letter-spacing: 0.5px; }
        .score-row { display: flex; justify-content: space-between; align-items: flex-start; margin: 10px 0; }
        .team-col { width: 40%; display: flex; flex-direction: column; }
        .team-name { font-size: 1rem; font-weight: bold; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
        .goal-times { font-size: 0.75rem; color: var(--gold); margin-top: 4px; min-height: 14px; font-family: monospace; }
        .score-box { background: #21262d; padding: 8px 14px; border-radius: 8px; border: 1px solid #30363d; font-family: monospace; font-size: 1.2rem; font-weight: bold; }
        
        /* CONFIDENCE BADGES */
        .pred-row { display: flex; justify-content: space-between; align-items: center; background: rgba(255, 255, 255, 0.05); padding: 10px; border-radius: 8px; margin-top: 10px; }
        .pred-text { color: var(--green); font-weight: bold; font-size: 0.9rem; }
        .conf-badge { padding: 4px 8px; border-radius: 6px; font-size: 0.8rem; font-weight: bold; color: #000; }
        .conf-high { background-color: var(--green); } 
        .conf-med { background-color: var(--gold); }   
        .conf-low { background-color: #8b949e; }
        
        /* GIANT KILLER BADGE */
        .upset-badge {
            background: rgba(218, 54, 51, 0.15); border: 1px solid var(--red); color: var(--red);
            font-size: 0.75rem; font-weight: bold; text-align: center;
            padding: 6px; border-radius: 6px; margin-top: 8px; letter-spacing: 0.5px;
            display: flex; align-items: center; justify-content: center; gap: 6px;
        }

        .scan-btn { position: fixed; bottom: 30px; left: 5%; width: 90%; background: var(--green); color: white; border: none; padding: 16px; border-radius: 16px; font-size: 1.1rem; font-weight: bold; box-shadow: 0 5px 20px rgba(0,0,0,0.5); z-index: 100; }
        .player-btn { width: 100%; background: #21262d; border: 1px solid #30363d; color: #ccc; padding: 10px; margin-top: 10px; border-radius: 8px; font-weight: 600; }
    </style>
</head>
<body>

    <header>
        <div class="top-row">
            <h1><img src="target_PNG26.png" style="width:28px;"> Hunter</h1>
            <button id="pilotBtn" class="pilot-btn" onclick="togglePilot()">
                <div class="pilot-dot"></div> Auto-Pilot
            </button>
        </div>
        
        <select id="filterSelect" onchange="applyFilter()">
            <option value="elite">üá¨üáß UK & Top Tier</option>
            <option value="europe">üá™üá∫ Rest of Europe</option>
            <option value="world">üåé World Scan</option>
        </select>
    </header>

    <div id="content">
        <div style="text-align:center; padding-top:50px; color:#888;">
            <p style="font-size:2rem; margin-bottom:10px;">üî≠</p>
            <p>Ready to Hunt (60'-85').</p>
            <p style="font-size:0.8rem; color:#555">Active Filters: No Friendlies/Youth</p>
        </div>
    </div>

    <button class="scan-btn" onclick="runScan()" id="mainBtn">üéØ SCAN MARKETS</button>

    <script>
        const API_KEY = "0f29a2f96e9dd4231cee515cc5ec52b0"; 
        
        // --- ELITE IDS (Major Leagues) ---
        const ELITE_IDS = [39, 40, 41, 42, 179, 140, 78, 135, 61, 2, 3, 45, 48, 143, 529, 556, 81];
        
        // --- THE FULL EUROPE LIST ---
        const EU_COUNTRIES = [
            "Albania", "Andorra", "Armenia", "Austria", "Azerbaijan", "Belarus", "Belgium", "Bosnia", "Bulgaria", 
            "Croatia", "Cyprus", "Czech Republic", "Czech-Republic", "Denmark", "England", "Estonia", "Faroe Islands", 
            "Finland", "France", "Georgia", "Germany", "Gibraltar", "Greece", "Hungary", "Iceland", "Ireland", 
            "Israel", "Italy", "Kazakhstan", "Kosovo", "Latvia", "Liechtenstein", "Lithuania", "Luxembourg", 
            "Malta", "Moldova", "Montenegro", "Netherlands", "Northern Ireland", "North Macedonia", "Norway", 
            "Poland", "Portugal", "Romania", "Russia", "San Marino", "Scotland", "Serbia", "Slovakia", "Slovenia", 
            "Spain", "Sweden", "Switzerland", "Turkey", "Ukraine", "Wales"
        ];

        let allMatches = [];
        let pilotMode = false;
        let pilotInterval;
        
        const content = document.getElementById('content');
        const mainBtn = document.getElementById('mainBtn');
        const pilotBtn = document.getElementById('pilotBtn');

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playPing() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.frequency.setValueAtTime(800, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.5, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.4);
        }

        function togglePilot() {
            pilotMode = !pilotMode;
            if(pilotMode) {
                pilotBtn.classList.add('active');
                pilotBtn.innerHTML = `<div class="pilot-dot"></div> ON (60s)`;
                playPing(); 
                runScan(true); 
                pilotInterval = setInterval(() => runScan(true), 60000); 
            } else {
                pilotBtn.classList.remove('active');
                pilotBtn.innerHTML = `<div class="pilot-dot"></div> Auto-Pilot`;
                clearInterval(pilotInterval);
            }
        }

        async function runScan(isAuto = false) {
            if(!isAuto) {
                mainBtn.innerText = "Scanning Global Feeds..."; mainBtn.disabled = true;
                content.innerHTML = "<p style='text-align:center; margin-top:50px; color:#666'>Fetching live data...</p>";
            } else {
                mainBtn.innerText = "ü§ñ Auto-Scanning...";
            }
            
            try {
                const res = await fetch("https://v3.football.api-sports.io/fixtures?live=all", {
                    headers: { "x-rapidapi-key": API_KEY, "x-rapidapi-host": "v3.football.api-sports.io" }
                });
                const data = await res.json();
                
                if(!data.response || data.results === 0) {
                    if(!isAuto) content.innerHTML = "<p style='text-align:center; margin-top:50px'>No live games.</p>";
                    allMatches = [];
                } else {
                    allMatches = data.response.filter(m => m.fixture.status.elapsed >= 60 && m.fixture.status.elapsed <= 85);
                    
                    // --- SORTING LOGIC: DESCENDING TIME ---
                    // This puts 85' games at top, 60' games at bottom
                    allMatches.sort((a, b) => b.fixture.status.elapsed - a.fixture.status.elapsed);
                    
                    applyFilter(isAuto);
                }
            } catch(e) { if(!isAuto) content.innerHTML = "<p style='text-align:center; margin-top:50px; color:#da3633'>Error.</p>"; }
            
            mainBtn.innerText = "üéØ SCAN MARKETS"; mainBtn.disabled = false;
        }

        function applyFilter(isAuto = false) {
            const mode = document.getElementById('filterSelect').value;
            content.innerHTML = "";
            let highValueFound = false;

            if(allMatches.length === 0) { content.innerHTML = "<p style='text-align:center; margin-top:50px; color:#888'>No games in 60-85min window.</p>"; return; }

            const filtered = allMatches.filter(m => {
                // --- JUNK FILTER ---
                const league = (m.league.name || "").toLowerCase();
                const blocked = ["friendly", "friendlies", "club friendlies", "u19", "u20", "u21", "u23", "youth", "reserve", "reserves"];
                
                if(blocked.some(word => league.includes(word))) {
                    return false; 
                }

                const lid = m.league.id;
                const country = m.league.country;
                
                if (mode === 'elite') return ELITE_IDS.includes(lid); 
                else if (mode === 'europe') {
                    // Check against the FULL LIST of European countries
                    return EU_COUNTRIES.includes(country) || ELITE_IDS.includes(lid);
                }
                else return true;
            });

            if(filtered.length === 0) {
                content.innerHTML = `<p style='text-align:center; margin-top:50px; color:#888'>No ${mode.toUpperCase()} games found.</p>`;
            } else {
                filtered.forEach(m => {
                    const t = m.fixture.status.elapsed;
                    const s = m.goals;
                    if ((Math.abs(s.home - s.away) === 1 && t > 75) || (s.home === s.away && t > 75)) {
                        highValueFound = true;
                    }
                    createCard(m);
                });
            }

            if(isAuto && highValueFound) playPing();
        }

        function createCard(m) {
            const div = document.createElement('div');
            div.className = 'match-card';
            
            const h = m.teams.home;
            const a = m.teams.away;
            const s = m.goals;
            const t = m.fixture.status.elapsed;
            const lid = m.league.id;
            
            let hGoals = "", aGoals = "";
            if (m.events) {
                hGoals = m.events.filter(e => e.type === 'Goal' && e.team.id === h.id).map(e => e.time.elapsed + "'").join(', ');
                aGoals = m.events.filter(e => e.type === 'Goal' && e.team.id === a.id).map(e => e.time.elapsed + "'").join(', ');
            }

            let upsetHtml = "";
            if (ELITE_IDS.includes(lid) && s.home < s.away && (s.away - s.home === 1)) {
                upsetHtml = `<div class="upset-badge">üî• UPSET ALERT: ${h.name} Chasing!</div>`;
            }

            let predText = "Monitoring...";
            let confVal = 0;
            let confClass = "conf-low";

            if (s.home === s.away) {
                predText = "‚ö†Ô∏è Draw / Tight Game";
                confVal = (t > 75) ? 88 : 80; 
            } 
            else if (Math.abs(s.home - s.away) === 1) {
                predText = "‚öΩ Late Goal Likely";
                confVal = (t > 75) ? 90 : 82;
            } 
            else {
                predText = "üîí Result Likely Safe";
                confVal = 94;
            }
            
            if(upsetHtml !== "") {
                predText = "üî• Late Goal (Favorite Chasing)";
                confVal = 95;
            }

            if(confVal >= 80) confClass = "conf-high";
            else if(confVal >= 60) confClass = "conf-med";

            div.innerHTML = `
                <div class="league-name">${m.league.country} ‚Ä¢ ${m.league.name}</div>
                <div class="score-row">
                    <div class="team-col" style="align-items:flex-end; text-align:right;">
                        <span class="team-name">${h.name}</span>
                        <span class="goal-times">${hGoals}</span>
                    </div>
                    <span class="score-box">${s.home}-${s.away}</span>
                    <div class="team-col" style="align-items:flex-start; text-align:left;">
                        <span class="team-name">${a.name}</span>
                        <span class="goal-times">${aGoals}</span>
                    </div>
                </div>
                <div style="text-align:center; color:#888; font-size:0.8rem; margin-top:5px;">${t}' Played</div>
                ${upsetHtml}
                <div class="pred-row">
                    <span class="pred-text">${predText}</span>
                    <span class="conf-badge ${confClass}">${confVal}%</span>
                </div>
                <button class="player-btn" onclick="checkPlayers(this, ${m.fixture.id})">üïµÔ∏è Check Players</button>
                <div id="p-${m.fixture.id}"></div>
            `;
            content.appendChild(div);
        }

        async function checkPlayers(btn, id) {
            btn.innerText = "Analyzing...";
            try {
                const res = await fetch(`https://v3.football.api-sports.io/fixtures/players?fixture=${id}`, {
                    headers: { "x-rapidapi-key": API_KEY, "x-rapidapi-host": "v3.football.api-sports.io" }
                });
                const data = await res.json();
                const area = document.getElementById(`p-${id}`);
                
                let html = "";
                if(data.response && data.response.length > 0) {
                    data.response.forEach(t => t.players.forEach(p => {
                        const s = p.statistics[0];
                        if(s.shots.on >= 2 && s.goals.total === 0) {
                            let pConf = (s.shots.on >= 3) ? 92 : 78; 
                            let cClass = (pConf > 80) ? "#2ea043" : "#d29922";
                            html += `<div style="display:flex; justify-content:space-between; margin-top:8px; font-size:0.9rem; color:${cClass}">
                                        <span>üéØ ${p.player.name} To Score</span>
                                        <span style="font-weight:bold">${pConf}%</span>
                                     </div>`;
                        }
                        if(s.fouls.committed >= 3 && !s.cards.yellow) {
                            let fConf = (s.fouls.committed >= 4) ? 95 : 82;
                            html += `<div style="display:flex; justify-content:space-between; margin-top:8px; font-size:0.9rem; color:#da3633">
                                        <span>üü® ${p.player.name} Card Risk</span>
                                        <span style="font-weight:bold">${fConf}%</span>
                                     </div>`;
                        }
                    }));
                }
                area.innerHTML = html || "<div style='font-size:0.8rem; color:#666; text-align:center; margin-top:5px'>No high value signals.</div>";
            } catch(e) { }
            btn.style.display = 'none';
        }

        if ('serviceWorker' in navigator) {
            const blob = new Blob([`self.addEventListener('fetch', () => {});`], {type: 'application/javascript'});
            navigator.serviceWorker.register(URL.createObjectURL(blob));
        }
        let deferredPrompt;
        const installBtn = document.getElementById('installBtn');
        window.addEventListener('beforeinstallprompt', (e) => { e.preventDefault(); deferredPrompt = e; installBtn.style.display = 'block'; });
        installBtn.addEventListener('click', async () => { if (deferredPrompt) { deferredPrompt.prompt(); deferredPrompt = null; installBtn.style.display = 'none'; } });
    </script>
</body>
</html>
